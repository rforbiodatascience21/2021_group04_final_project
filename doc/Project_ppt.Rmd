---
title: "Phenotyping of <br> SARS-CoV-2-specific T cells"
author: "Group 4 - Marcus Göransson, Marie Christine Viuff, Signe Koggersbøl Skadsborg, Susana Patricia Hernandez, Yogesh Basavaraju"
date: "11 May 2021"
output: ioslides_presentation
widescreen: true
smaller: true
#logo: "../doc/DTU logo.png"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library("tidyverse")
library("ggpubr")
library("knitr")
library("readxl")
```


## Introduction

* The current COVID-19 pandemia, caused by the SARS-CoV-2 virus, has caused the death of more than 3.2 million people worldwide.  
* Studies in convalescent patients has shown a decline of antibody-mediated response a few months after infection. 

* CD8+ T cells are critical for efficient clearance of virus-infected cells and long-term protection against SARS-CoV-2.

* DTU HealthTech Department analyzed T cell recognition towards SARS-CoV-2-derived peptides in COVID-19 patients and healthy individuals using DNA-barcoded pMHC multimers combined with a T cell phenotype panel.

## Objective

* The project utilizes flow cytometry data published by Saini et al., 2021, to make a T cell phenotype analysis by comparing the expression of cell surface markers in COVID-19 patients and healthy individuals to better understand T cell immunity to SARS-CoV-2 infection.

```{r, echo=FALSE, warning=FALSE, out.width = "700px", fig.align='center', fig.cap="Fig. 1-Experimental pipeline for T cell identification from COVID-19 patients."}
#include_graphics("../doc/Pipeline-1.png")
```

* The COVID-19 pandemic is caused by the highly infectious virus; SARS-CoV-2. 
* CD8+ T cells perform essential functions in the control and elimination of viral infections
* Here, we analyze the immunophenotypes of CD8 T cells that can recognize peptides from the SARS-CoV-2 genome 
* We compare COVID-19 patients with healthy donors (HD) never exposed to the virus.
* Furthermore, we compare the phenotypes to the severity of the disease.
* We also compare the phenotype of the SARS-CoV-2 specific CD8 T cells with T cells that recognize common viruses.



## Materials and methods

### Phenotype data


- Phenotyping of immune cells provides imformation abouts the activation status of the cells
- This is obtained through antibody staining and flow cytometry, which transforms a fluorescent signal into a voltage.
- Cell populations of specific phenotype is gated in FlowJo software, and frequencies of positive cells can afterwards exported as an .xlsx file



```{r, echo=FALSE, warning=FALSE, message=FALSE}
covid_data_raw <- read_excel("../data/_raw/covid_data.xlsx")
write_tsv(x = covid_data_raw,
          file = "../data/01_covid_data.tsv")
covid_data <- read_tsv(file = "../data/01_covid_data.tsv")
```


## Raw data {.smaller}

* The dataset is obtained from S. K. Saini *et al., Sci. Immunol.* (2021)

```{r}
covid_data_raw
```



## Data wrangling 
### Tidying the data set
* Change NA values
* Add cohort group as a new variable
* Collapse multiple columns into two columns: Gating and Fraction
* Splitting the gating path into two new columns: Parent and Last population


```{r, augment, echo=FALSE, warning=FALSE, message=FALSE}
covid_data_clean <- read_tsv(file = "../data/02_covid_data_clean.tsv")
covid_data_augment <- covid_data_clean %>% 
  pivot_longer(cols = contains("lymphocytes"),
               names_to = "Gating",
               values_to = "Fraction") %>% 
  mutate(T_cell = case_when(str_detect(Gating, "CD8") ~ "CD8",
                            str_detect(Gating, "CD4") ~ "CD4"),
         Parent_population = str_match(Gating, "\\S+\\/(\\S+)\\/\\S+$")[,2],
         Last_population = str_match(Gating, "\\S+\\/(\\S+)$")[,2],
         .before = Fraction)
```
```{r, covid_data_augment}
covid_data_augment
```

## FCS files

* .fcs files are the raw data files obtained with flow cytometry.
* In addition to manual gating, these files can be used for clustering and visualizing the cells' expression levels of multiple parapeters in 2 dimensions with UMAP (Uniform Manifold Approximation and Projection).

## Visualizing the data

* Reading covid_data_augment
* Filtering on Parent and Last population
* Generate plot using ggplot - Boxplot and dotplot
* Multiple plots viewed as facetwrap
* Used geomsigif with Kruskal test





# Results {.smaller}


## Figure A

```{r fig_A, echo = FALSE, out.width = "900px", out.height= "300px", fig.align='center'}
include_graphics("../results/04_fig_A.png")
```

## Figure B + C

```{r fig_B+C, echo = FALSE, out.width = "900px", out.height= "300px", fig.align='center'}
include_graphics("../results/04_fig_B.png")
include_graphics("../results/04_fig_C.png")

```

## Figure D

```{r fig_D, echo = FALSE, out.width = "900px", out.height= "300px", fig.align='center'}
include_graphics("../results/04_fig_D.png")

```

## Figure E

```{r fig_E, echo = FALSE, out.width = "900px", out.height= "300px", fig.align='center'}
include_graphics("../results/04_fig_E.png")
```

## Figure F

```{r fig_F, echo = FALSE, out.width = "900px", out.height= "300px", fig.align='center'}
include_graphics("../results/04_fig_F.png")
```

## Figure S7 B

```{r fig_S7B , echo = FALSE, out.width = "900px", out.height= "300px", fig.align='center'}
include_graphics("../results/04_fig_S7B.png")
```

## Figure S8 C

```{r fig_S8C , echo = FALSE, out.width = "900px", out.height= "300px", fig.align='center'}
include_graphics("../results/04_fig_S8C.png")
```

## UMAP visualization

```{r UMAP , echo = FALSE, out.width = "900px", out.height= "300px", fig.align='center'}
# include_graphics("../results/04_fig_UMAP.png")
```

## Conclusion

* list the main results!!


